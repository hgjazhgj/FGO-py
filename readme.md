> 考试结束,低空飘过  
> 新年福袋想要综合排名(分先后,斜体之后有卡池):  
> 术尼禄/*伊莉雅*/*莉莉丝*/*剑尼禄*/黑骑呆/阿比/*魔总*/老福/*闪闪*/其余待定
# 警告
<<哔哩哔哩游戏平台用户协议>>第19条中规定:  
2、未经许可的第三方软件指可用于在游戏中获取优势,但不属于相应本平台游戏一部分的任何文件或程序 ,包括作弊性质的外挂以及相关辅助性质的外挂等(包括但不限于自动升级、自动练级、自动吃药、自动完成任务、加速性质、模拟加点、战斗显血或其他超出游戏设定范围的操作)。如若发现使用作弊性质的外挂以及相关辅助性质的外挂等,我们将对其采取严厉的处罚措施,包括:没收玩家利用第三方软件进行游戏而直接、间接获得之不正当利益;倒扣数值(包括但不限于经验值) ; 撤销交易;扣除违规交易所得;交易功能限制;暂时冻结玩法;永久冻结玩法;强制离线;暂时禁止登录;永久禁止登录;删除档案;承担法律责任。  
由于使用本脚本而导致的包括但不限于上述各项的损失本人概不负责,您下载并使用该脚本即代表您已知晓使用脚本可能带来的风险并愿意承担可能出现的后果,望周知  
---
# 使用说明 Instruction 
模拟器必须全屏显示在1920\*1080的显示屏上,窗口可以被遮挡但是不能被隐藏或最小化  
若要用于真机,参见[这里](#如何将此脚本应用于真机)  
虽然改几行代码就能应用于任意分辨率,但这可能导致识别问题,需要手动修改精度限制  
**请在手机的/sdcard目录下新建一个名为adbtemp的文件夹**  
你的电脑上要有[adb](https://developer.android.google.cn/studio/command-line/adb)  
你得会一点点python,不用很多,因为本脚本的[1.0版本(代码已经被删掉了,但是当时录了个视频)](https://www.bilibili.com/video/av34399081)是用c写的,很多东西就是直接翻译过来的面向过程的代码  
使用了以下库:  
time os functools numpy cv2 win32con win32ui win32gui  

本脚本就一个源文件,直接运行或编辑  
代码最后几行就是主程序  
+ 在点击列表中第一个关卡就能进入选择助战界面的界面启动main函数来清空体力条,该函数有至少三个参数:要吃的苹果数(默认0),苹果种类(0金1银2铜3彩,默认0),战斗函数(默认oneBattle).之后是要向战斗函数中传递的各项参数  
+ 在进入战斗后尚未选卡的界面启动oneBattle函数来完成这一战斗,若传入一个有三个int的list就会在各stage优先攻击左起自1开始编号的敌人  
+ 在进入战斗后尚未选卡的界面启动otk函数来完成自定义的三回合速刷,需手动配置操作行为

这个脚本是会自动放技能(可以设定,默认不用技能),自动放宝具(可以设定,默认充能满就直接放宝具),自动选卡(优先三色chain,否则优先红卡).合理设定后实战10-13回合能够刷完无限池终本  
每一回合的战斗都会输出相应信息用于debug,包括:  
1. 当前回合数  
2. 当前stage数  
3. 这一stage已经进行的回合数  
4. 各技能是否冷却完毕  
5. 各宝具是否充能完毕  
6. 各指令卡颜色  
7. 选择的指令卡序列  

我的联系方式  
qq 979449732  
email huguangjing0411@geektip.cc  
有任何问题或bug反馈请联系,觉得有帮助请为我star  
请向可怜的非酋投喂<del>圣晶石</del>彩苹果  
## 你需要修改slnPath,adbPath和androidTitle  
slnPath是本解决方案的绝对位置,方便你把代码和其他资源分开放  
adbpath要根据你的设备连接方式进行修改  
androidTitle为显示游戏画面的窗口标题,该窗口大小必须为1920\*1080且没有边框  
如果你的屏幕不是1920\*1080的,你就得把游戏的显示画面调整到正好1920\*1080并且在每一次截图后把边框裁掉  
## 你可以修改skillInfo数组
skillInfo列表记录了技能的信息  
skillInfo[编队中的第i个从者]\[的第j个技能]=[的最小使用stage数,在该stage的最小使用回合数,指向的目标(没有目标置0)]  
也就是说,若不使用技能就skillInfo[i]\[j]\[0]=4  
这样的安排足以应付日常周回的各种情况,比如三面Boss充能五格,就把保命技能=[3,6,0]  
## 你可以修改houguInfo数组
houguInfo列表记录了宝具的信息  
houguInfo[编队中的第i个从者]=[的宝具的最小使用stage数,在该stage的最小使用回合数,是否优先使用(优先置1)]  
## 助战 Friends
由于当前版本可以筛选礼装,本脚本又不需要限定特定从者,所以此功能默认是禁用的,你可以在main函数中chooseFriend的注释挪到他的下一行来启用助战选取功能  
你需要事先将你期望的各种助战的样子截图为png放在asserts/friend下,参照asserts/friend/unused中的文件  
**被截图范围都应该可以点击来选中该好友**,实际的点击位置为图片的正中央  
如果你用的是模拟器,请使用本程序的screenShot函数来截图而不要用模拟器自带的截图,更不要用prtSc键来截图,这可能会导致识别错误  
如果你用的是手机,screenShot函数也可以大大方便你的操作  
助战截图的名称中若有下划线'_',且下划线之前的部分为km,ml,cba,则代表好友就挂的是孔明,梅林,十八岁美少女,这会影响助战技能的使用,参见chooseFriend函数具体实现  
## 如何将此脚本应用于真机
v2.7.x及之前版本能在任意支持python和adb的系统上用于任何Android设备,v2.7版本的代码现在也是可以用的尽管可能不是那么稳定,x2.8.0及之后的版本仅仅由于截图方式由adb改为win32api而只能在windows系统上用于1920*1080的屏幕,如果使用真机,要么把手机屏幕找一个投屏软件投到屏幕上要么把Check.__init__()中的注释挪到最后两行以启用先前版本的截图函数,注意,由于当前版本是基于新截图方式进行的优化,进行此替换虽然不会导致错误,但是会使运行效率比v2.7.x还要低得多得多  
使用真机时,你还需要以下操作:  
如果不是16:9屏幕,你得修改dpx为左侧的蓝边宽度,例如2160\*1080就dpx=(2160-1920)/2=120  
通常真机会比较卡,你得在各种地方添加延迟,并适当增加Fuse.__max
# 注意 Caution
模拟器窗口必须保持全屏显示,所以强烈建议关闭模拟器的"老板键(boss key)"功能  
若战斗失败会自动撤退并留下记录然后继续下一把(若战斗失败就发出噪音把你吵醒起来改代码?倒也不是不能做到啦~)  
有些时候对从者头像的识别会有错误,*虽然在不断以各种方式优化,但这个问题至今未完全解决,需要更合理的框选匹配范围* ,所以**如果你打算睡觉去,就不要用后排的技能**,否则万一一觉起来发现打第二把的时候就卡住了...  
# Q&A&杂谈  
2018年9月,一件大事发生了,没有人知道这个游戏正在经历一场变革  
那时我刚上大学,年轻人有的是时间,有的是精力,就开始研究怎么压榨电脑的剩余价值.答案就是这个脚本的前身,FGO-C.那时候的脚本功能跟现在GitHub上别人写的脚本差不多简陋,就是想尽一切办法三回合宝具速刷,速刷不了就凉凉.但是那时候尼禄祭终本是术阶的,计算器一敲正好可以小莫稳定3t,当时还有专门的计算程序,C#写的,可惜现在那个NGA帖子和GitHub项目都找不到了.54年10月31日,尼禄·克劳狄乌斯继承皇位,成为当时罗马帝国即位年龄最小的皇帝.2018年10月31日,我和千千万万玩家一起肝尼禄祭.那次的尼禄祭,283池.  
尝到了这么大的甜头,怎么能停得下来!当时没有现在这么高级的功能,只有用Win32API的keybd_event来模拟键盘事件,必须保持模拟器窗口完整显示并处于激活状态.当初为什么不用adb呢?因为**adb算是对Android的操作,有可能被检测**,这也是为什么日服禁root禁USB调试禁模拟器的原因,而**用Windows的函数隔着一层虚拟机你拿头来检测我** !这样的日子过得挺安逸,直到有一天,我突然发现我当时用的mumu模拟器禁用了虚拟键盘事件,可能是处于效率和延时考虑换成了更底层的实现,这要我来写的话就得创建虚拟设备然后发送硬件扫描码了.有点头大.于是我下定决心换用adb.同时也把语言改成了python,纯粹是因为python处理字符串简单.
众所周知,python是万能的.于是我不断开发这个脚本,尝试了各种各样的功能,那些曾经使用现已废弃的部分仍可见于被注释掉的部分.先是PIL.Image读取像素进行识别,然后进化成了open-cv的matchTemplate.终于,从"开环控制"变为了"闭环控制".下一步,也就是v3.0版本的目标,一是建立所有从者的数据库,标明技能宝具的详细信息,二是在战斗中获取敌方的信息和更多己方的信息,三是依靠一二两条中的信息在战斗中实现真正智能化的技能施放和选卡.也就是**我能打过的高难用同样的阵容脚本也能打个八九不离十**.而至于本脚本的究极形态,就是**服务器维护我也维护,维护结束我立刻上号挂机,把玩家变成只会抽卡的机器** .当然我有生之年要是没有利益可图就应该不会开发v3.0版,倒不如说2.8这一版本已经接近我心中的究极形态了.  
自古以来,我就有在模拟器上把每个技能每个按键都设置一个键位然后用键盘玩fgo的习惯,当初正是因为敲键盘只有按下弹起两种消息,不想鼠标要设定坐标,相对简单明了,比如看到'A'就知道时使用第一个技能,看到(109,860)就一脸懵B,这一思想贯彻到了现在,代码里的key就是干的这件事.这样虽然看起来很蠢,一点都不"面向对象",但却是**别人的代码得好几个文件加起来上千行,我的代码只要一个文件300+行,还功能比别人强,debug比别人容易**的根本原因.能**实现智能战斗不间断,不靠礼装不用拐** 的,github上怕不是**只有我一个**  
承接上文,我自知这个脚本功能过于强大,强大到了严重影响游戏平衡,改变游戏性质,急剧扩大玩家间差异的程度.就算是在GitHub上开源我都是下了决心的.2020年刚过,B站up主[MCLAREN--](https://space.bilibili.com/13033022)搞了一套硬件来在iOS上跑脚本[视频](https://www.bilibili.com/video/av82095192),[专栏](https://www.bilibili.com/read/cv4303413).注意到**硬件不被B站的条款限制**(虽然法律还是会管的),所以等我什么时候有空了,就搞一套差不多的硬件,我的脚本底层交互接口从adb到伺服电机一改,新瓶装旧酒,挂羊头卖狗肉地出个视频既可以让网友们看到我的脚本,又不怕帐号被封,岂不美哉!  
# 版本记录 Version Logs
## 2020/01/09 v2.8.3
期末考结束了...  
稳定性大优化  
全面修订readme  
## 2020/01/08 v2.8.2
截图从<某个已经消失的版本>的qt改回win32api了...  
修改了一些判定的模板图片  
由于截图效率的提高,正在尝试用多帧来进行一次判定来提高可靠性,比如houguinfo  
## 2020/01/08 v2.8.0
稳定性优化  
肝!
## 2020/01/07 v2.8.0beta  
紧急更新  
本次更新内容可靠性未经充分验证,请谨慎下载使用  
使用了win32api代替之前的adb进行截图,单次截图时间从1s级别减低到了10ms级别  
这段代码是不带裁剪和缩放的,所以**需要模拟器在正好1920\*1080的显示器上全屏显示,真机的话要用投屏软件**  
由于之前的代码有一些地方是依赖截图的耗时来进行延迟的,这一延迟消失后可能引发各种各样的问题,所以我正在一点一点地在必要的地方加上显式延迟,但是仍然会有疏漏,之后发现一个解决一个,慢慢改  
## 2020/01/03 v2.7.0
打版本日志的时候突然发现已经2020年了...期末考好累...  
圣诞活动7号晚上开始,但是期末考9号才结束...  
所以复习放一边去,先把脚本给写了  
重大bug修复,带指向的技能现在会正确地施放了(尽管识别错误的问题仍然存在)  
微调了部分按键坐标,**现在你可以吃银苹果和铜苹果了**  
小优化,切换目标后加了冗余点击以关闭在点击已选中目标时产生的敌人详情对话框  
增加了所谓"快速换装(setSkillInfo)"函数,**先把配置写好,然后活动一开就上号挂机岂不美哉**!  
flag:我圣诞要吃光苹果,当前金苹果当量287  
## 2019/11/26 v2.6.0
蓝叠模拟器更到最新版就不会闪退了  
chooseFriend函数还是挺重要的,要用来选取特定从者  
明天(2019年11月27日星期三)上午8:30通关主线第8话(前篇)后开启炎舞击退战,
增加了一小段代码用于otk,现在直接运行脚本就是单次执行该脚本  
这段代码专用于"三美少女队",如果你没有bba/cba中的任何一个,或嫖不到cba,告辞.  
需要极地迦勒底制服  
**本次活动特攻是"特殊的魔放",会稀释其他的倍率,可恶!**  
## 2019/11/10 v2.5.2
版本更新后蓝叠模拟器闪退,在物理机上的兼容性未发现显著问题.  
版本更新后可以对助战礼装进行筛选,chooseFriend函数变得不再重要,已在主程序中禁用.